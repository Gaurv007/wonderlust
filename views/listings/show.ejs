<!-- <% layout("layouts/boilerplate") %>

  <div class="row mt-3">
    <div class="col-8 offset-3">
      <h3>
        <%= listing.title %>
      </h3>
    </div>
    <div class="card col-6 offset-3 show-card listing-card">
      <img src="<%=listing.image.url%>" class="card-img-top show-img" alt="listing_image">
      <div class="card-body">
        <p class="card-text">
          Owned by -
          <i>
            <%=listing.owner.username%>
          </i>
        </p>

        <p>
          <%= listing.description %>
        </p>

        <p>₹ <%= listing.price?.toLocaleString("en-IN") || "N/A" %> /Night </p>
        <p>
          <%= listing.location %>
        </p>
        <p>
          <%= listing.country %>
        </p>

      </div>

      <%if(curruser && listing.owner._id.equals(curruser._id)) {%>
        <div class="btns">
          <a class="btn btn-dark col-1 offset-3 edit-btn" href="/listings/<%= listing.id %>/edit">Edit</a>
          <form action="/listings/<%=listing._id%>?_method=DELETE" method="POST">
            <button class="btn btn-dark offset-5">Delete</button>
          </form>
        </div>
        <%}%>
          <div class="col-8 offset-3 mb-3">
            <% if(curruser ) {%>

              <hr>
              <h4>Leave a Review.</h4>
              <form novalidate class="needs-validation" action="/listings/<%=listing._id%>/reviews" method="POST">
        
                <div class="mb-3 mt-3">

                  <label class="form-label" for="rating">Rating</label>

                  <fieldset class="starability-slot">


                    <input type="radio" id="no-rate" class="input-no-rate" name="review[rating]" value="1" checked
                      aria-label="No rating." />
                    <input type="radio" id="first-rate1" name="review[rating]" value="1" />
                    <label for="first-rate1" title="Terrible">1 star</label>
                    <input type="radio" id="first-rate2" name="review[rating]" value="2" />
                    <label for="first-rate2" title="Not good">2 stars</label>
                    <input type="radio" id="first-rate3" name="review[rating]" value="3" />
                    <label for="first-rate3" title="Average">3 stars</label>
                    <input type="radio" id="first-rate4" name="review[rating]" value="4" />
                    <label for="first-rate4" title="Very good">4 stars</label>
                    <input type="radio" id="first-rate5" name="review[rating]" value="5" />
                    <label for="first-rate5" title="Amazing">5 stars</label>
                  </fieldset>
                </div>


                <div class="mb-3 mt-3">
                  <label class="form-label" for="comment">Comment</label>
                  <textarea required name="review[comment]" id="comment" cols="30" row="5"
                    class="form-control"></textarea>
                  <div class="invalid-feedback">please submit some commet ans review</div>
                </div>
                <button class="btn btn-outline-dark">Submit</button>
              </form>

          </div>
          <hr>
          <%}%>


            <p> <b>All reviews </b></p>
            <div class="row">



              <%for(review of listing.reviews){%>
                <div class="card col-5 ms-3 mb-3">
                  <div class="card-body">
                    <h5 class="card-title">@<%= review.author.username %>
                    </h5>
                    <p class="card-text">
                      <%= review.comment %>
                    </p>

                    <p class="starability-result card-text" data-rating="<%= review.rating %>"></p>
                  </div>

                  <form action="/listings/<%= listing._id %>/reviews/<%= review._id %>?_method=DELETE" class="mb-3"
                    method="POST">
                    <button class="btn btn-sm btn-dark">Delete</button>
                  </form>
                </div>
                <% }%>
            </div>
    </div> -->


    <% layout("layouts/boilerplate") %>

<style>
/* Show Page Container */
.show-page-container {
  max-width: 1200px;
  margin: 0 auto;
  padding: 2rem 1rem;
}

/* Header Section */
.listing-header {
  margin-bottom: 2rem;
}

.listing-title {
  font-size: 2.5rem;
  font-weight: 700;
  color: #1F2937;
  font-family: 'Playfair Display', serif;
  margin-bottom: 0.5rem;
}

.listing-meta {
  display: flex;
  align-items: center;
  gap: 1.5rem;
  flex-wrap: wrap;
  color: #6B7280;
  font-size: 0.95rem;
}

.listing-meta i {
  color: #FF385C;
}

/* Image Gallery */
.image-gallery {
  border-radius: 16px;
  overflow: hidden;
  margin-bottom: 3rem;
  box-shadow: 0 10px 40px rgba(0, 0, 0, 0.15);
  position: relative;
}

.show-img {
  width: 100%;
  height: 500px;
  object-fit: cover;
  transition: transform 0.5s ease;
}

.image-gallery:hover .show-img {
  transform: scale(1.05);
}

/* Main Content Grid */
.content-grid {
  display: grid;
  grid-template-columns: 1.5fr 1fr;
  gap: 3rem;
  margin-bottom: 3rem;
}

/* Listing Details Card */
.details-card {
  background: white;
  border-radius: 16px;
  padding: 2rem;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
}

.owner-info {
  display: flex;
  align-items: center;
  gap: 1rem;
  padding: 1.5rem;
  background: linear-gradient(135deg, #F9FAFB 0%, #FFFFFF 100%);
  border-radius: 12px;
  margin-bottom: 1.5rem;
}

.owner-avatar {
  width: 50px;
  height: 50px;
  border-radius: 50%;
  background: linear-gradient(135deg, #FF385C 0%, #E31C5F 100%);
  display: flex;
  align-items: center;
  justify-content: center;
  color: white;
  font-weight: 700;
  font-size: 1.5rem;
}

.owner-details h5 {
  margin: 0;
  color: #1F2937;
  font-weight: 600;
}

.owner-details p {
  margin: 0;
  color: #6B7280;
  font-size: 0.9rem;
}

.description-section {
  margin-bottom: 2rem;
  line-height: 1.8;
  color: #374151;
}

.property-features {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 1rem;
  margin-top: 2rem;
}

.feature-item {
  display: flex;
  align-items: center;
  gap: 0.75rem;
  padding: 1rem;
  background: #F9FAFB;
  border-radius: 10px;
  transition: all 0.3s ease;
}

.feature-item:hover {
  background: #FFF5F7;
  transform: translateX(5px);
}

.feature-item i {
  color: #FF385C;
  font-size: 1.25rem;
}

/* Booking Card */
.booking-card {
  background: white;
  border-radius: 16px;
  padding: 2rem;
  box-shadow: 0 8px 24px rgba(0, 0, 0, 0.12);
  position: sticky;
  top: 2rem;
  border: 1px solid #E5E7EB;
}

.price-display {
  font-size: 2rem;
  font-weight: 700;
  color: #1F2937;
  margin-bottom: 1.5rem;
}

.price-display .currency {
  color: #FF385C;
}

.price-display .night {
  font-size: 1rem;
  font-weight: 400;
  color: #6B7280;
}

/* Action Buttons */
.btns {
  display: flex;
  gap: 1rem;
  margin-top: 1.5rem;
}

.edit-btn,
.btns button {
  flex: 1;
  padding: 0.875rem 1.5rem;
  border-radius: 10px;
  font-weight: 600;
  transition: all 0.3s ease;
  border: none;
  cursor: pointer;
}

.edit-btn {
  background: linear-gradient(135deg, #10B981 0%, #059669 100%);
  color: white;
  text-decoration: none;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 0.5rem;
  box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
}

.edit-btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 6px 16px rgba(16, 185, 129, 0.4);
  color: white;
}

.btns form {
  flex: 1;
  margin: 0;
}

.btns button {
  width: 100%;
  background: linear-gradient(135deg, #EF4444 0%, #DC2626 100%);
  color: white;
  box-shadow: 0 4px 12px rgba(239, 68, 68, 0.3);
}

.btns button:hover {
  transform: translateY(-2px);
  box-shadow: 0 6px 16px rgba(239, 68, 68, 0.4);
}

/* Reviews Section */
.reviews-section {
  margin-top: 3rem;
  padding-top: 3rem;
  border-top: 2px solid #E5E7EB;
}

.reviews-header {
  font-size: 1.75rem;
  font-weight: 700;
  color: #1F2937;
  margin-bottom: 2rem;
  display: flex;
  align-items: center;
  gap: 0.5rem;
}

.reviews-header i {
  color: #FF385C;
}

/* Review Form */
.review-form-card {
  background: linear-gradient(135deg, #F9FAFB 0%, #FFFFFF 100%);
  border-radius: 16px;
  padding: 2rem;
  margin-bottom: 3rem;
  border: 2px solid #E5E7EB;
}

.review-form-card h4 {
  color: #1F2937;
  font-weight: 600;
  margin-bottom: 1.5rem;
}

.form-label {
  font-weight: 600;
  color: #374151;
  margin-bottom: 0.5rem;
  display: block;
}

.form-control {
  border: 2px solid #E5E7EB;
  border-radius: 10px;
  padding: 0.75rem 1rem;
  transition: all 0.3s ease;
  background: white;
}

.form-control:focus {
  border-color: #FF385C;
  box-shadow: 0 0 0 4px rgba(255, 56, 92, 0.1);
  outline: none;
}

.btn-outline-dark {
  padding: 0.75rem 2rem;
  border-radius: 10px;
  font-weight: 600;
  border: 2px solid #1F2937;
  color: #1F2937;
  background: white;
  transition: all 0.3s ease;
}

.btn-outline-dark:hover {
  background: linear-gradient(135deg, #1F2937 0%, #111827 100%);
  color: white;
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(31, 41, 55, 0.3);
}

/* Star Rating Styling */
.starability-slot {
  margin-bottom: 1rem;
}

.starability-slot label {
  cursor: pointer;
  font-size: 1.5rem;
}

/* Review Cards */
.reviews-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
  gap: 1.5rem;
}

.review-card {
  background: white;
  border-radius: 16px;
  padding: 1.5rem;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
  border: 2px solid #F3F4F6;
  transition: all 0.3s ease;
}

.review-card:hover {
  border-color: #FF385C;
  transform: translateY(-4px);
  box-shadow: 0 8px 20px rgba(255, 56, 92, 0.15);
}

.review-author {
  display: flex;
  align-items: center;
  gap: 0.75rem;
  margin-bottom: 1rem;
}

.review-avatar {
  width: 40px;
  height: 40px;
  border-radius: 50%;
  background: linear-gradient(135deg, #8B5CF6 0%, #7C3AED 100%);
  display: flex;
  align-items: center;
  justify-content: center;
  color: white;
  font-weight: 700;
}

.review-card h5 {
  font-size: 1rem;
  font-weight: 600;
  color: #1F2937;
  margin: 0;
}

.review-card p {
  color: #6B7280;
  line-height: 1.6;
  margin-bottom: 1rem;
}

.review-card .btn-sm {
  padding: 0.5rem 1rem;
  border-radius: 8px;
  font-size: 0.875rem;
  background: #EF4444;
  border: none;
  color: white;
  transition: all 0.3s ease;
}

.review-card .btn-sm:hover {
  background: #DC2626;
  transform: scale(1.05);
}

.starability-result {
  margin-top: 0.5rem;
}

/* Responsive */
@media (max-width: 992px) {
  .content-grid {
    grid-template-columns: 1fr;
  }
  
  .booking-card {
    position: static;
  }
  
  .show-img {
    height: 350px;
  }
  
  .listing-title {
    font-size: 2rem;
  }
  
  .reviews-grid {
    grid-template-columns: 1fr;
  }
}

@media (max-width: 768px) {
  .btns {
    flex-direction: column;
  }
  
  .property-features {
    grid-template-columns: 1fr;
  }
  
  .show-img {
    height: 250px;
  }
}
</style>

<div class="show-page-container">
  
  <!-- Listing Header -->
  <div class="listing-header">
    <h1 class="listing-title"><%= listing.title %></h1>
    <div class="listing-meta">
      <span><i class="fas fa-map-marker-alt"></i> <%= listing.location %>, <%= listing.country %></span>
    </div>
  </div>

  <!-- Image Gallery -->
  <div class="image-gallery">
    <img src="<%=listing.image.url%>" class="show-img" alt="<%= listing.title %>">
  </div>

  <!-- Content Grid -->
  <div class="content-grid">
    
    <!-- Left Column - Details -->
    <div>
      <div class="details-card">
        
        <!-- Owner Info -->
        <div class="owner-info">
          <div class="owner-avatar">
            <%= listing.owner.username.charAt(0).toUpperCase() %>
          </div>
          <div class="owner-details">
            <h5>Hosted by <%= listing.owner.username %></h5>
            <p>Property Owner</p>
          </div>
        </div>

        <!-- Description -->
        <div class="description-section">
          <h4 style="margin-bottom: 1rem; color: #1F2937;">About this place</h4>
          <p><%= listing.description %></p>
        </div>

        <!-- Features -->
        <div class="property-features">
          <div class="feature-item">
            <i class="fas fa-map-marker-alt"></i>
            <span><%= listing.location %></span>
          </div>
          <div class="feature-item">
            <i class="fas fa-globe"></i>
            <span><%= listing.country %></span>
          </div>
        </div>
      </div>
    </div>

    <!-- Right Column - Booking Card -->
    <div>
      <div class="booking-card">
        <div class="price-display">
          <span class="currency">₹</span><%= listing.price?.toLocaleString("en-IN") || "N/A" %> 
          <span class="night">/night</span>
        </div>

        <%if(curruser && listing.owner._id.equals(curruser._id)) {%>
          <div class="btns">
            <a class="edit-btn" href="/listings/<%= listing.id %>/edit">
              <i class="fas fa-edit"></i> Edit
            </a>
            <form action="/listings/<%=listing._id%>?_method=DELETE" method="POST">
              <button type="submit">
                <i class="fas fa-trash"></i> Delete
              </button>
            </form>
          </div>
        <%}%>
      </div>
    </div>
  </div>

  <!-- Reviews Section -->
  <div class="reviews-section">
    
    <!-- Review Form -->
    <% if(curruser) {%>
      <div class="review-form-card">
        <h4><i class="fas fa-star"></i> Leave a Review</h4>
        <form novalidate class="needs-validation" action="/listings/<%=listing._id%>/reviews" method="POST">
          
          <div class="mb-3">
            <label class="form-label" for="rating">Rating</label>
            <fieldset class="starability-slot">
              <input type="radio" id="no-rate" class="input-no-rate" name="review[rating]" value="1" checked aria-label="No rating." />
              <input type="radio" id="first-rate1" name="review[rating]" value="1" />
              <label for="first-rate1" title="Terrible">1 star</label>
              <input type="radio" id="first-rate2" name="review[rating]" value="2" />
              <label for="first-rate2" title="Not good">2 stars</label>
              <input type="radio" id="first-rate3" name="review[rating]" value="3" />
              <label for="first-rate3" title="Average">3 stars</label>
              <input type="radio" id="first-rate4" name="review[rating]" value="4" />
              <label for="first-rate4" title="Very good">4 stars</label>
              <input type="radio" id="first-rate5" name="review[rating]" value="5" />
              <label for="first-rate5" title="Amazing">5 stars</label>
            </fieldset>
          </div>

          <div class="mb-3">
            <label class="form-label" for="comment">Comment</label>
            <textarea required name="review[comment]" id="comment" cols="30" rows="5" class="form-control" placeholder="Share your experience..."></textarea>
            <div class="invalid-feedback">please submit some comment and review</div>
          </div>

          <button class="btn btn-outline-dark">
            <i class="fas fa-paper-plane"></i> Submit Review
          </button>
        </form>
      </div>
    <%}%>

    <!-- All Reviews -->
    <h3 class="reviews-header">
      <i class="fas fa-comments"></i> All Reviews (<%= listing.reviews.length %>)
    </h3>
    
    <div class="reviews-grid">
      <%for(review of listing.reviews){%>
        <div class="review-card">
          <div class="review-author">
            <div class="review-avatar">
              <%= review.author.username.charAt(0).toUpperCase() %>
            </div>
            <h5>@<%= review.author.username %></h5>
          </div>
          
          <p class="starability-result" data-rating="<%= review.rating %>"></p>
          
          <p><%= review.comment %></p>

          <% if(curruser && review.author._id.equals(curruser._id)) {%>
            <form action="/listings/<%= listing._id %>/reviews/<%= review._id %>?_method=DELETE" method="POST">
              <button class="btn btn-sm" type="submit">
                <i class="fas fa-trash"></i> Delete
              </button>
            </form>
          <%}%>
        </div>
      <%}%>
    </div>

  </div>

</div>

<script>
// Form validation
(function() {
  'use strict';
  const forms = document.querySelectorAll('.needs-validation');
  
  Array.prototype.slice.call(forms).forEach(function(form) {
    form.addEventListener('submit', function(event) {
      if (!form.checkValidity()) {
        event.preventDefault();
        event.stopPropagation();
      }
      form.classList.add('was-validated');
    }, false);
  });
})();
</script>